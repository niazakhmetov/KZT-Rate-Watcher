
name: Обновление Курсов (CDI)

# Контролирует, когда рабочий процесс будет запущен
on:
  # Замена стандартных CI-триггеров (push/pull_request)
  # на триггер по расписанию для ежедневного обновления данных.
  # Ежедневно в 07:00 UTC+5 (02:00 UTC).
  schedule:
    - cron: '0 2 * * *' 
  
  # Позволяет Вам запустить этот рабочий процесс вручную через вкладку Actions
  workflow_dispatch:

# Рабочий процесс состоит из одного задания
jobs:
  # Называем задание 'update-data' вместо стандартного 'build'
  update-data:
    # Тип раннера, на котором будет запущено задание
    runs-on: ubuntu-latest
    
    # Разрешение на запись для GITHUB_TOKEN (решает проблему 403)
    permissions:
      contents: write 
      pull-requests: read
      
    # Шаги представляют собой последовательность задач
    steps:
      # Шаг 1: Получение репозитория (Аналогично: uses: actions/checkout@v4)
      - name: 1. Клонирование репозитория
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }} 

      # Шаг 2: Настройка Python
      - name: 2. Настройка Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      # Шаг 3: Установка зависимостей (Аналогично: Run a one-line script)
      - name: 3. Установка зависимостей (requests)
        run: pip install -r requirements.txt
        
      # Шаг 4: Запуск скрипта (Основная логика)
      - name: 4. Запуск скрипта парсинга НБК
        run: python src/parser_script.py
        
      # Шаг 5: Коммит обновленного JSON (Аналогично: Run a multi-line script - для деплоя)
      - name: 5. Автоматический коммит и пуш данных
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_user_name: KZT Rates Bot
          commit_user_email: actions-bot@github.com
          commit_message: 'Automated: Update KZT exchange rates data'
          file_pattern: 'publicdata/latest_rates.json'
