# –ò–º—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
name: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ö—É—Ä—Å–æ–≤ –ù–ë–ö

on:
  # 1. –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (Cron Job)
  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 04:00 UTC (–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è).
  # –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–æ –≤—Ä–µ–º—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–æ–≥–¥–∞ –ù–ë–ö –æ–±—ã—á–Ω–æ –ø—É–±–ª–∏–∫—É–µ—Ç –¥–∞–Ω–Ω—ã–µ.
  schedule:
    - cron: '0 4 * * *' 
  
  # 2. –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub Actions
  workflow_dispatch:

jobs:
  update-rates:
    # –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –æ–±—Ä–∞–∑–µ Linux
    runs-on: ubuntu-latest
    
    steps:
      # –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: Checkout repository
        uses: actions/checkout@v4
        # –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        with:
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å auto-commit
          token: ${{ secrets.GITHUB_TOKEN }} 

      # –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python
      - name: Set up Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (requests)
      - name: Install dependencies
        run: pip install -r requirements.txt
        
      # –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JSON
      - name: Run Python parser script
        run: python src/python/parser_script.py
        
      # –®–∞–≥ 5: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–º–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ JSON-—Ñ–∞–π–ª–∞
      # –≠—Ç–∞ Action –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ data/latest_rates.json, –∏, –µ—Å–ª–∏ –¥–∞,
      # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–º–∏—Ç–∏—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ –≤–µ—Ç–∫—É.
      - name: Commit and push updated JSON data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ü§ñ Automated: Update KZT exchange rates data'
          files: 'data/latest_rates.json' # –£–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
          # force: true # –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö edge-–∫–µ–π—Å–∞—Ö
