# –ò–º—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
name: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ö—É—Ä—Å–æ–≤ –ù–ë–ö

on:
  # 1. –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 07:00 UTC+5)
  schedule:
    - cron: '0 2 * * *' 
  
  # 2. –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub Actions
  workflow_dispatch:

jobs:
  update-rates:
    runs-on: ubuntu-latest
    
    # –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞–ø–∏—Å—å –¥–ª—è GITHUB_TOKEN (—Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É 403)
    permissions:
      contents: write 
      pull-requests: read # –û—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã, —Ö–æ—Ç—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
      
    steps:
      # –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }} 

      # –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python
      - name: Set up Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          
      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      - name: Install dependencies
        run: pip install -r requirements.txt
        
      # –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JSON
      - name: Run Python parser script
        run: python src/parser_script.py
        
      # –®–∞–≥ 5: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–º–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ JSON-—Ñ–∞–π–ª–∞
      - name: Commit and push updated JSON data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
          commit_user_name: KZT Rates Bot
          # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—á—Ç—ã –¥–ª—è –∫–æ–º–º–∏—Ç–∞
          commit_user_email: actions-bot@github.com
          commit_message: 'ü§ñ Automated: Update KZT exchange rates data'
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä file_pattern (—É—Å—Ç—Ä–∞–Ω—è–µ—Ç Warning)
          file_pattern: 'data/latest_rates.json'
